$(function(){Pace.start();Pace.on("done",function(){if(getQueryVariable("ajaxlink")){setup.init_from_ajax=true;}
    init_lightbox();init_content();resize_window();init_moire();update_header();main_nav_init();sub_nav_init();init_page_scroller();requestAnimationFrame(repeatOften);init_content_links();init_readmore();init_accordion();init_members();init_pins();init_footer();insertAdditionalLinksInMainNav();$(".page.lila").children(".content").css({"padding-top":500});$(window).resize(function(){resize_window();});init_imagescroll();resize_window();update_content_positions();if(is_tablet){masterscroller=new IScroll('#masterscroller',{scrollbars:true,mouseWheel:true,interactiveScrollbars:true,shrinkScrollbars:'scale',fadeScrollbars:true,bounce:false,probeType:3,click:true});}else{masterscroller=new IScroll('#masterscroller',{scrollbars:true,mouseWheel:true,interactiveScrollbars:true,shrinkScrollbars:'scale',fadeScrollbars:true,bounce:false,probeType:3});}
    init_history();$("#masterscroller").animate({opacity:1},function(){resize_lightbox();});masterscroller.on('scrollEnd',function(evt){moire.animated_intro=false;});$("#cookie_info").find(".open-policy").on("click",function(event){event.preventDefault();$("footer").find(".open-policy").click();});init_cookie_info();});});function init_cookie_info(){if($("#cookie_info").length>0){$("#cookie_info").find("button").on("click",function(){$("#cookie_info").remove();$("#masterscroller").removeClass("with_cookie");$("#main").removeClass("with_cookie");$("#icon_holder").removeClass("with_cookie");$("#icon_holder_second").removeClass("with_cookie");resize_window();$.get("/functions/cookie_info_ok.php");});}}
function insertAdditionalLinksInMainNav(){var lastNavItemTop=parseInt($("#main > ul > li").last().css('top'));$(".lightbox_content").each(function(index,element){lastNavItemTop+=65;var newElement=$("<li />").css({"top":lastNavItemTop,}).append($(element).clone());$("#main > ul").append(newElement);});}
function resize_window(){if($("#masterscroller").hasClass("with_cookie")){var cutoff=220;}else{var cutoff=120;}
    setup.window.height=$(window).height();setup.window.width=$(window).width();moire.height=setup.window.height-cutoff;moire.width=setup.window.width;console.log(moire.height);if(moire.height>$(".moire_background").height()){moire.height=$(".moire_background").height();}
    $("#moire").css({height:moire.height});$(".placeholder").css({"height":moire.height});$(".outerimage").each(function(){$(this).css({height:$(this).find(".img-holder").height()});});moire_set_image_classes();moire_set_background_position();moire_set_initial_image_position();resize_lightbox();resize_content();update_content_positions();};function repeatOften(){update_header();requestAnimationFrame(repeatOften);};function resize_lightbox(){var lightbox_height=setup.window.height-65;if(setup.current_scroll_id==setup.contentpos.length-1){lightbox_height=setup.window.height-65;}
    lightboxer.content.css({height:lightbox_height,top:65});}
function resize_content(){var content_height=setup.window.height-65;contener.content.css({height:content_height});contener.content.children(".pagewrap").css({height:setup.window.height});}
function update_header(){setup.window.scrolltop=(-1)*masterscroller.y;update_pagescroller_arrow();if(!setup.init_from_ajax&&history_inited){upate_pagescroller();}
    if($("nav#main").hasClass("out")&&setup.window.is_scrolling){main_nav_out();}
    if(setup.sub_page.in||lightboxer.visible||contener.visible)return;var ny=(moire.height-setup.window.scrolltop)/2;if(setup.window.scrolltop>moire.height){moire_hide();}else{moire_show();}
    if($("#masterscroller").hasClass("with_cookie")){var cutoff=100;}else{var cutoff=0;}
    if(ny<=65){var nhs=moire.height-setup.window.scrolltop-120;var nh=65;if(nhs>=-55){nh=120+nhs;}
        $("header").css({top:60+cutoff,height:nh});if(!$("header").hasClass("fixed")){var header=$("header").remove();$("body").append(header.addClass("fixed"));}
        $("#going_back").children("a").off("click");$("#going_back").children("a").on("click",function(event){event.preventDefault();go_back();});header_in();}else{$("header").css({top:setup.window.scrolltop+ny,height:120});if($("header").hasClass("fixed")){var header=$("header").remove();$("#onepager").append(header.removeClass("fixed"));}
        $("#going_back").children("a").off("click");$("#going_back").children("a").on("click",function(event){event.preventDefault();go_back();});header_out();}};function header_in(){if(moire.animated_intro||contener.visible)return;if(parseInt($(".logo_cont").css("left"))!=-65&&!moire.animated_intro){moire.animated_intro=true;window.clearTimeout(timeouts.header);$(".intro_text").stop().animate({opacity:0},{duration:100,complete:function(){timeouts.header=window.setTimeout(function(){$(".logo_cont").animate({left:-65},{duration:400,complete:function(){moire.show_intro=false;moire.animated_intro=false;}});},200);}});}
else{}}
function header_out(){if(moire.animated_intro)return;if(parseInt($(".logo_cont").css("left"))!=-165&&!moire.animated_intro){moire.animated_intro=true;$(".logo_cont").stop().animate({left:-165},400,function(){$(".intro_text").stop().animate({opacity:1},{duration:200,complete:function(){moire.show_intro=true;moire.animated_intro=false;}});});}else{}}
function update_content_positions(){setup.contentpos=new Array();setup.contentpos.push({y:0,height:moire.height});var starty=moire.height;$(".outerpagewrap").each(function(){var pos={y:starty-35,height:$(this).height()}
    starty=starty+$(this).height();var nobj=$(this).next();if($(this).next().hasClass("outerimage")){starty+=nobj.height();}
    setup.contentpos.push(pos);});}
function update_pagescroller_arrow(){if(setup.current_scroll_id==setup.contentpos.length-1){if(!$("#pfeil").hasClass("rotated")){$("#pfeil").stop().animate({bottom:70},function(){$("#pfeil").rotate({angle:0,animateTo:180});});$("#pfeil").addClass("rotated");}}else{if($("#pfeil").hasClass("rotated")){$("#pfeil").stop().animate({bottom:40},function(){$("#pfeil").rotate({angle:180,animateTo:0});});$("#pfeil").removeClass("rotated");}}}
function upate_pagescroller(){if(setup.sub_page.level!=1){return;}
    var setindex=0;for(i=0;i<setup.contentpos.length;i++){if(setup.window.scrolltop>=setup.contentpos[i].y){setindex=i;}}
    if(setindex!=setup.current_scroll_id){setup.current_scroll_id=setindex;History.pushState({level:1,url:pageindexes[setup.current_scroll_id],prevent_animation:true},null,pageindexes[setup.current_scroll_id]);}}
function init_page_scroller(){$("#pfeil").children("a").click(function(event){event.preventDefault();update_content_positions();var next_scrollid=setup.current_scroll_id+1;if(next_scrollid==setup.contentpos.length){next_scrollid=0;}
    console.log(pageindexes[next_scrollid]);History.pushState({level:1,url:pageindexes[next_scrollid]},null,pageindexes[next_scrollid]);return false;});}
function init_imagescroll(){$('.img-holder').imageScroll({image:null,imageAttribute:'image',holderClass:'imageHolder',container:$('body'),speed:0.2,coverRatio:0.59,holderMinHeight:200,extraHeight:0,mediaWidth:1600,mediaHeight:800,parallax:true,touch:false});}
function init_content_links(){$(".content").find("a").on("click",function(event){if($(this).hasClass("emailc")){if(is_tablet){}}else{event.preventDefault();if($(this).hasClass("lightbox")){return;}
    $(this).closest(".content").prev().find("a[href='"+$(this).attr("href")+"']").click();return;}});}
function init_readmore(){$(".read_more").each(function(){var p=$(this).prev();var r=$(this).remove();p.append(r);$(this).off("click");$(this).on("click",function(event){event.preventDefault();$(this).closest(".intro").next().slideToggle(function(){update_content_positions();});$(this).fadeOut();});});$("div.copy.hidden").each(function(){var a=$("<span/>").addClass("arrow up");$(a).off("click");$(a).on("click",function(event){event.preventDefault();$(this).closest(".copy").slideToggle(function(){update_content_positions();});$(this).closest(".copy").prev().find(".read_more").fadeIn();});});}
function init_accordion(){$(".accordion").each(function(){$(this).children("h2").off("click");$(this).children("h2").on("click",function(){if($(".accordion.open").length>0){var its_id=$(this).parent().index();var open_id=$(".accordion.open").index();if(its_id!=open_id){$(".accordion.open").children("h2").next().slideToggle();$(".accordion.open").toggleClass("open");}}
    $(this).next().slideToggle(function(){update_content_positions();});$(this).parent().toggleClass("open");});});}
function init_pins(){$(".pagewrap.lila").find(".map").find(".pin").each(function(index){var pos=$(this).attr("data-pos").split(",");$(this).css({top:(pos[1]-100)+"px",left:(pos[0]-15)+"px",opacity:0});var sel=this;$(this).on("click",function(event){event.preventDefault();var csel=this;$(this).parent().next().find("nav.sub").find("a").each(function(){if($(this).attr("href")==$(csel).attr("href")){$(this).click();}});});});$('.lila.withmap').find(".map").find(".inviewer").bind('inview',function(event,isInView,visiblePartX,visiblePartY){if(!setup.sub_page.is_map_page){if(isInView){if(visiblePartY=='top'){}else if(visiblePartY=='bottom'){}else{$(".pagewrap.lila").find(".map").find(".pin").each(function(index){var sel=this;var pos=$(this).attr("data-pos").split(",");timeouts.pins[index]=window.setTimeout(function(){$(sel).animate({top:(pos[1]-40),opacity:1});},index*200);});}}else{$(".pagewrap.lila").find(".map").find(".pin").each(function(index){var sel=this;var pos=$(this).attr("data-pos").split(",");$(this).css({top:(pos[1]-100)+"px",left:(pos[0]-15)+"px",opacity:0});});}}});}
function init_mandanten(){if(mandanten.length==0){$(".mandanten").eq(0).find("dl").children("dd").each(function(index){var obj={name:$(this).text().toLowerCase(),branche:$(this).next().text().toLowerCase(),name_raw:$(this).html(),branche_raw:$(this).next().html()};mandanten[index]=obj;});}
    $(".mandanten").find(".sort.dd").off("click");$(".mandanten").find(".sort.dd").addClass("active").attr("ref",1).on("click",function(){if(!$(this).hasClass("active")){$(this).addClass("active");$(".mandanten").find(".sort.dt").removeClass("active");}
        sort_mandanten($(this).attr("ref"),1);if($(this).attr("ref")==1){$(this).attr("ref",-1);$(this).toggleClass("up");}else{$(this).attr("ref",1);$(this).toggleClass("up");}});$(".mandanten").find(".sort.dt").off("click");$(".mandanten").find(".sort.dt").attr("ref",1).on("click",function(){if(!$(this).hasClass("active")){$(this).addClass("active");$(".mandanten").find(".sort.dd").removeClass("active");}
        sort_mandanten($(this).attr("ref"),2);if($(this).attr("ref")==1){$(this).attr("ref",-1);$(this).toggleClass("up");}else{$(this).attr("ref",1);$(this).toggleClass("up");}});;sort_mandanten(1,1);$(".mandanten").find(".sort.dd").attr("ref",-1);}
function sort_mandanten(dir,pos){if(pos==1){if(dir>0){mandanten.sort(function(a,b){if(a.name<b.name)return-1;if(a.name>b.name)return 1;return 0;});}else{mandanten.sort(function(a,b){if(a.name<b.name)return 1;if(a.name>b.name)return-1;return 0;});}}
    if(pos==2){if(dir>0){mandanten.sort(function(a,b){if(a.branche<b.branche)return-1;if(a.branche>b.branche)return 1;return 0;});}else{mandanten.sort(function(a,b){if(a.branche<b.branche)return 1;if(a.branche>b.branche)return-1;return 0;});}}
    $(".mandanten").find("dd").remove();$(".mandanten").find("dt").remove();for(i=0;i<mandanten.length;i++){var dd=$("<dd/>").html(mandanten[i].name_raw);var dt=$("<dt/>").html(mandanten[i].branche_raw);$(".mandanten").find("dl").append(dd);$(".mandanten").find("dl").append(dt);}}
function has_lightbox(){if(setup.sub_page.current_container.find("#lightbox").length>0){return true;}
    return false;}
function go_back_quick(scindex){var scrolltoindex=scindex;if(setup.sub_page.loading)return false;if(has_lightbox()){if(setup.sub_page.is_map_page){close_lightbox_quick(setup.sub_page.current_container.find("#lightbox").find(".close"));}else{close_lightbox_projects_quick(setup.sub_page.current_container.find("#lightbox").find(".close"));}}
    setup.sub_page.loading=true;var head=$(".head[ref='"+setup.sub_page.id+"']");$(".outerpagewrap[rel='"+setup.sub_page.id+"']").stop().animate({scrollTop:0},{duration:500,complete:function(){head.find("nav.sub").find("li.active").removeClass("active");$.get(setup.sub_page.url,function(data){var content=head.parent().children(".content");var new_content=$(data).children(".pagewrap").children(".wrap").children(".page").children(".content");var p=content.position();var ww=0-((setup.window.width-840)/2)-840;new_content_clone=new_content.clone();new_content_clone.hide();new_content_clone.css({visibility:"hidden"});head.parent().append(new_content_clone);new_content.addClass("animate");new_content.css({left:ww,top:p.top});head.parent().append(new_content);content.css({overflow:"hidden"});head.children("h2").stop().fadeOut(500,function(){new_content_clone.show();var content_clone=content.clone();content_clone.addClass("animate");content_clone.css({top:p.top});head.parent().append(content_clone);content.remove();content_clone.stop().animate({left:-ww},{duration:800,complete:function(){$(content_clone).remove();}});new_content.stop().animate({left:0},{duration:800,complete:function(){new_content_clone.css({visibility:"visible"});var new_h2=$(data).children(".pagewrap").children(".wrap").children(".page").children(".head").children("h2");new_h2.hide();head.append(new_h2);new_h2.stop().fadeIn(500);$(new_content).remove();$("body").removeClass("noflow");setup.sub_page.loading=false;reinit_content_functions();var bsp=setup.window.backupscrollposition;$(".outerpagewrap[rel='"+setup.sub_page.id+"']").removeClass("scroller");if(!$(".outerpagewrap[rel='"+setup.sub_page.id+"']").hasClass("withmap")){$(".outerpagewrap[rel='"+setup.sub_page.id+"']").find(".background").removeClass("fixed");}
                $("body,html").scrollTop(bsp);window.scrollTo(0,bsp);var nextid=setup.sub_page.id;nextid++;if($(".outerpagewrap[rel='"+nextid+"']").length>0){var fakebackground=$("<div/>").addClass("fakebg");$(".outerpagewrap[rel='"+nextid+"']").prepend(fakebackground);var bgdifh=$(".outerpagewrap[rel='"+setup.sub_page.id+"']").find(".pagewrap").height();}
                var bg_to_height=$(".outerpagewrap[rel='"+setup.sub_page.id+"']").find(".pagewrap").height();if($(".outerpagewrap[rel='"+setup.sub_page.id+"']").hasClass("withmap")){bg_to_height+=500;}
                $(".outerpagewrap[rel='"+setup.sub_page.id+"']").find(".background").stop().animate({"height":bg_to_height},{duration:500,complete:function(){$(".logo_cont").stop().animate({left:-65},400);$("html").css('overflow',"scroll");$(this).removeAttr("style");var curid=setup.sub_page.id;setup.sub_page.in=false;setup.sub_page.id=false;setup.sub_page.url=false;setup.sub_page.loading=false;setup.update_parallax=true;$("#pfeil").fadeIn();$(".fakebg").remove();if($(".outerpagewrap[rel='"+curid+"']").hasClass("withmap")){var maxPaddingTop=500;$(".map").removeClass("hasgradient");$(".page.lila").children(".content").animate({"padding-top":500},{duration:1000,step:function(currentPaddingTop){var percentage=1-(currentPaddingTop/maxPaddingTop);var mapTop=350-(400*percentage);var mapGradientStart=0.4*percentage;var mapGradientEnd=1*percentage;$(".map").find(".pin").css({opacity:1.3-(1*percentage)});$(".map").css({zIndex:1,top:mapTop,background:"linear-gradient(rgba(50, 0, 50, "+mapGradientStart+"), rgba(50, 0, 50, "+mapGradientEnd+")),url(/images/module/140415_sx_005_weltkarte_ds.png) no-repeat"});$(".page.lila").children(".content").css({paddingBottom:500-currentPaddingTop});},complete:function(){$(".background.lila").css({position:"absolute"});$('html, body').animate({scrollTop:$("#page"+scrolltoindex).offset().top-35},1200);}});}else{$('html, body').animate({scrollTop:$("#page"+scrolltoindex).offset().top-35},1200);}},step:function(currentHeight){if($(".outerpagewrap[rel='"+nextid+"']").length>0){$(".fakebg").css({height:currentHeight-bgdifh});}}});}});$(this).remove();count_go_backs++;});});}});}
function close_lightbox(sel){var asel=$(sel);$("#lightbox").fadeOut(800,function(){$(".page.lila").css({paddingTop:54,height:"auto",display:"none"});$(".background.lila").animate({"background-color":"#320033"},{duration:500,complete:function(){$(".page.lila").css({background:"none"});$(".pagewrap.lila").css({height:"auto"});$(".pagewrap.lila").children(".wrap").css({height:"auto"});$(".page.lila").show();asel.closest(".page").children(".head").show();asel.closest(".page").children(".content").show();asel.closest(".page").children(".head").animate({opacity:1},{duration:500,step:function(currentOpacity){asel.closest(".page").children(".content").css({opacity:currentOpacity});$(".map").css({opacity:currentOpacity});},complete:function(){$("#lightbox").remove();setup.sub_page.level=0;}});}});});}
function close_lightbox_projects(sel){var asel=$(sel);$("#lightbox").fadeOut(800,function(){asel.closest(".outerpagewrap").find(".page").css({paddingTop:54,display:"none"});asel.closest(".outerpagewrap").find(".pagewrap").css({"background-color":"#FFF"});asel.closest(".outerpagewrap").find(".background").animate({"background-color":"#FFF"},{duration:500,complete:function(){asel.closest(".outerpagewrap").find(".page").css({background:"none"});asel.closest(".outerpagewrap").find(".page").show();asel.closest(".page").children(".head").show();asel.closest(".page").children(".content").show();asel.closest(".page").children(".head").stop().animate({opacity:1},{duration:500,step:function(currentOpacity){asel.closest(".page").children(".content").css({opacity:currentOpacity});},complete:function(){$("#lightbox").remove();setup.sub_page.level=0;}});}});});}
function close_lightbox_quick(sel){var asel=$(sel);$("#lightbox").fadeOut(200,function(){$(".page.lila").css({paddingTop:54,height:"auto",display:"none"});$(".background.lila").animate({"background-color":"#320033"},{duration:200,complete:function(){$(".page.lila").css({background:"none"});$(".pagewrap.lila").css({height:"auto"});$(".pagewrap.lila").children(".wrap").css({height:"auto"});$(".page.lila").show();asel.closest(".page").children(".head").show();asel.closest(".page").children(".content").show();asel.closest(".page").children(".head").animate({opacity:1},{duration:200,step:function(currentOpacity){asel.closest(".page").children(".content").css({opacity:currentOpacity});$(".map").css({opacity:currentOpacity});},complete:function(){$("#lightbox").remove();setup.sub_page.level=0;}});}});});}
function close_lightbox_projects_quick(sel){var asel=$(sel);$("#lightbox").fadeOut(200,function(){asel.closest(".outerpagewrap").find(".page").css({paddingTop:54,display:"none"});asel.closest(".outerpagewrap").find(".pagewrap").css({"background-color":"#FFF"});asel.closest(".outerpagewrap").find(".background").animate({"background-color":"#FFF"},{duration:200,complete:function(){asel.closest(".outerpagewrap").find(".page").css({background:"none"});asel.closest(".outerpagewrap").find(".page").show();asel.closest(".page").children(".head").show();asel.closest(".page").children(".content").show();asel.closest(".page").children(".head").stop().animate({opacity:1},{duration:200,step:function(currentOpacity){asel.closest(".page").children(".content").css({opacity:currentOpacity});},complete:function(){$("#lightbox").remove();setup.sub_page.level=0;}});}});});}
function lightbox(sel){var ahref=$(sel).attr("href");var asel=$(sel);History.pushState({action:3,url:$(sel).attr("href"),index:$(sel).closest(".outerpagewrap").attr("rel")},null,$(sel).attr("href"));}
function lightbox_projects(sel,data){var asel=sel;var adata=data;asel.closest(".page").append(adata);asel.closest(".outerpagewrap").find(".background").css({position:"fixed"});asel.closest(".page").children(".head").animate({opacity:0},{duration:500,step:function(currentOpacity){asel.closest(".page").children(".content").css({opacity:currentOpacity});},complete:function(){asel.closest(".page").children(".head").hide();asel.closest(".page").children(".content").hide();}});asel.closest(".outerpagewrap").find(".pagewrap").css({"background-color":"#F3F5F4"});asel.closest(".outerpagewrap").find(".background").animate({"background-color":"#F3F5F4"},{duration:500,complete:function(){asel.closest(".outerpagewrap").find(".page").css({paddingTop:15});$("#lightbox").css({height:"inherit"}).fadeIn(800);init_accordion();init_lightbox_nav_projects();}});}
function lightbox_members(sel,data){var asel=sel;var adata=data;asel.closest(".page").append(adata);$(".map").css({opacity:0});asel.closest(".page").children(".head").animate({opacity:0},{duration:500,step:function(currentOpacity){asel.closest(".page").children(".content").css({opacity:currentOpacity});},complete:function(){asel.closest(".page").children(".head").hide();asel.closest(".page").children(".content").hide();}});$(".background.lila").animate({"background-color":"#F3F5F4"},{duration:500,complete:function(){$(".page.lila").css({paddingTop:15,backgroundColor:"#FFF",height:"100%"});$(".pagewrap.lila").css({height:"100%"});$(".pagewrap.lila").children(".wrap").css({height:"100%"});$("#lightbox").fadeIn(800);init_accordion();init_lightbox_nav();}});}
function pthis(){$("#lightbox").printArea({extraCss:"/css/print.css"});}
function getQueryVariable(variable){var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable){return pair[1];}}
    return false;}
window.requestAnimationFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60);};})();